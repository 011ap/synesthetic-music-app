<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Synesthetic - Digital Consciousness Engine</title>
    <meta name="description" content="Revolutionary music emotion analysis with synesthetic experiences. Feel music, share souls.">
    
    <!-- Load auth styles -->
    <link rel="stylesheet" href="auth-styles.css">
    
    <!-- Preload Revolutionary System Stylesheets -->
    <link rel="preload" as="style" href="🎨-revolutionary-interface/world-class-ui-system.css">
    <link rel="preload" as="style" href="🚀-ux-optimization/comprehensive-ux-system.css">
    
    <style>
        /* === MODERN CSS VARIABLES SYSTEM === */
        :root {
            /* Primary Colors */
            --bg-dark: #0a0a0f;
            --bg-darker: #050508;
            --bg-card: rgba(15, 15, 20, 0.8);
            --glass-light: rgba(255, 255, 255, 0.05);
            --glass-medium: rgba(255, 255, 255, 0.08);
            --glass-dark: rgba(0, 0, 0, 0.6);
            --glass-border: rgba(255, 255, 255, 0.12);
            
            /* Text Colors */
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.8);
            --text-tertiary: rgba(255, 255, 255, 0.6);
            --text-accent: #00f5ff;
            
            /* Synesthetic Colors */
            --synesthetic-primary: #00f5ff;
            --synesthetic-red: #ff006e;
            --synesthetic-blue: #0096ff;
            --synesthetic-green: #00ff88;
            --synesthetic-purple: #8b5cf6;
            --synesthetic-gold: #ffd700;
            --synesthetic-orange: #ff6b00;
            
            /* Spacing System */
            --space-xs: 0.5rem;
            --space-sm: 0.75rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-xxl: 3rem;
            
            /* Border Radius */
            --radius-sm: 0.5rem;
            --radius-md: 0.75rem;
            --radius-lg: 1rem;
            --radius-xl: 1.5rem;
            --radius-full: 9999px;
            
            /* Transitions */
            --transition-smooth: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-quick: all 0.2s ease;
            
            /* Shadows */
            --shadow-glass: 0 8px 32px rgba(0, 0, 0, 0.4);
            --shadow-glow: 0 0 40px rgba(0, 245, 255, 0.5);
            
            /* Z-index System */
            --z-background: -1;
            --z-content: 1;
            --z-header: 10;
            --z-overlay: 1000;
            --z-modal: 1100;
            --z-dropdown: 1200;
        }

        /* === RESET & BASE STYLES === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-darker) 100%);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        /* === ANIMATED BACKGROUND === */
        .emotional-background {
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            z-index: var(--z-background);
            opacity: 0.1;
            background: 
                radial-gradient(circle at 20% 50%, var(--synesthetic-red), transparent 40%),
                radial-gradient(circle at 80% 80%, var(--synesthetic-blue), transparent 40%),
                radial-gradient(circle at 40% 20%, var(--synesthetic-primary), transparent 40%);
            filter: blur(120px);
            animation: emotionalShift 20s ease-in-out infinite;
        }

        @keyframes emotionalShift {
            0%, 100% { transform: scale(1.5) rotate(0deg); }
            33% { transform: scale(2) rotate(120deg); }
            66% { transform: scale(1.3) rotate(240deg); }
        }

        /* === LAYOUT STRUCTURE === */
        .app-container {
            min-height: 100vh;
            position: relative;
            z-index: var(--z-content);
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-lg);
        }

        /* === HEADER SECTION === */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-xl) 0;
            border-bottom: 1px solid var(--glass-border);
            margin-bottom: var(--space-xxl);
            position: relative;
            z-index: var(--z-header);
        }

        .brand-section {
            text-align: center;
            flex: 1;
        }

        .brand-logo {
            font-size: clamp(2.5rem, 8vw, 4rem);
            font-weight: 200;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-sm);
            background: linear-gradient(135deg, var(--synesthetic-primary), var(--synesthetic-blue));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .brand-logo:hover {
            transform: scale(1.02);
            filter: drop-shadow(0 0 30px rgba(0, 245, 255, 0.5));
        }

        .brand-tagline {
            font-size: 1.125rem;
            color: var(--text-tertiary);
            font-weight: 300;
            letter-spacing: 0.02em;
        }

        /* === AUTHENTICATION SECTION === */
        .auth-section {
            position: relative;
        }

        .auth-btn {
            background: var(--glass-medium);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-full);
            padding: var(--space-sm) var(--space-lg);
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-smooth);
            backdrop-filter: blur(10px);
        }

        .auth-btn:hover {
            background: var(--glass-border);
            color: var(--text-primary);
            border-color: var(--synesthetic-primary);
            transform: translateY(-2px) scale(1.02);
            box-shadow: var(--shadow-glow);
        }

        .auth-btn.authenticated {
            background: linear-gradient(135deg, var(--synesthetic-primary), var(--synesthetic-blue));
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 15px rgba(0, 245, 255, 0.3);
        }

        /* === STATUS BAR === */
        .status-bar {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-sm);
            margin: var(--space-xl) auto;
            padding: var(--space-sm) var(--space-lg);
            background: var(--glass-light);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-full);
            width: fit-content;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--synesthetic-green);
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px var(--synesthetic-green);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }

        /* === CONTROL CARDS === */
        .controls-section {
            margin: var(--space-xxl) 0;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-lg);
            margin-top: var(--space-xl);
        }

        .control-card {
            background: var(--glass-light);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            text-align: center;
            cursor: pointer;
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }

        .control-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .control-card:hover::before {
            left: 100%;
        }

        .control-card:hover {
            background: var(--glass-medium);
            border-color: var(--synesthetic-primary);
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 245, 255, 0.2);
        }

        .control-icon {
            font-size: 3rem;
            margin-bottom: var(--space-md);
            filter: drop-shadow(0 0 10px currentColor);
            transition: var(--transition-smooth);
        }

        .control-card:hover .control-icon {
            transform: scale(1.1) rotate(5deg);
            filter: drop-shadow(0 0 20px var(--synesthetic-primary));
        }

        .control-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: var(--space-xs);
            color: var(--text-primary);
        }

        .control-subtitle {
            font-size: 0.875rem;
            color: var(--text-tertiary);
        }

        /* === ANALYSIS SECTION === */
        .analysis-section {
            margin: var(--space-xxl) 0;
            padding: var(--space-xl);
            background: var(--glass-medium);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            backdrop-filter: blur(20px);
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--space-xl);
            margin-top: var(--space-lg);
        }

        .analysis-display {
            background: var(--glass-light);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            padding: var(--space-xl);
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .analysis-placeholder {
            text-align: center;
            color: var(--text-secondary);
        }

        .analysis-placeholder .icon {
            font-size: 3rem;
            animation: pulse 2s ease-in-out infinite;
            margin-bottom: var(--space-md);
        }

        .emotional-readout {
            background: var(--glass-light);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
        }

        .readout-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-sm) 0;
            border-bottom: 1px solid var(--glass-border);
        }

        .readout-item:last-child {
            border-bottom: none;
        }

        .readout-label {
            color: var(--text-tertiary);
            font-size: 0.875rem;
        }

        .readout-value {
            color: var(--text-primary);
            font-weight: 600;
            transition: var(--transition-quick);
        }

        /* === UPLOAD SECTION === */
        .upload-section {
            margin: var(--space-xxl) 0;
            transition: var(--transition-smooth);
        }

        .upload-section.hidden {
            opacity: 0;
            transform: translateY(-20px);
            pointer-events: none;
        }

        .upload-area {
            background: var(--glass-light);
            border: 2px dashed var(--glass-border);
            border-radius: var(--radius-xl);
            padding: var(--space-xxl);
            text-align: center;
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .upload-area:hover,
        .upload-area.drag-over {
            border-color: var(--synesthetic-primary);
            background: rgba(0, 245, 255, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: var(--space-md);
            color: var(--synesthetic-primary);
        }

        .upload-text {
            font-size: 1.25rem;
            margin-bottom: var(--space-sm);
            color: var(--text-primary);
        }

        .upload-subtext {
            color: var(--text-tertiary);
            font-size: 0.875rem;
        }

        /* === ADMIN TOGGLE === */
        .admin-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, var(--synesthetic-purple), var(--synesthetic-blue));
            border: none;
            border-radius: var(--radius-full);
            padding: var(--space-md) var(--space-lg);
            color: white;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            z-index: var(--z-overlay);
            transition: var(--transition-smooth);
            box-shadow: 0 8px 25px rgba(138, 43, 226, 0.4);
            backdrop-filter: blur(20px);
            opacity: 0;
            visibility: hidden;
        }

        .admin-toggle.visible {
            opacity: 1;
            visibility: visible;
        }

        .admin-toggle:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 35px rgba(138, 43, 226, 0.6);
        }

        /* === REVOLUTIONARY OVERLAY === */
        .revolutionary-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }

        .revolutionary-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* === RESPONSIVE DESIGN === */
        @media (max-width: 768px) {
            .main-container {
                padding: var(--space-md);
            }

            .app-header {
                flex-direction: column;
                gap: var(--space-lg);
                text-align: center;
            }

            .analysis-grid {
                grid-template-columns: 1fr;
            }

            .controls-grid {
                grid-template-columns: 1fr;
            }

            .brand-logo {
                font-size: 2.5rem;
            }
        }

        /* === ACCESSIBILITY === */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }

            .emotional-background {
                animation: none;
            }
        }

        /* Focus indicators for keyboard navigation */
        .control-card:focus,
        .auth-btn:focus,
        .admin-toggle:focus {
            outline: 2px solid var(--synesthetic-primary);
            outline-offset: 2px;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --glass-light: rgba(255, 255, 255, 0.15);
                --glass-medium: rgba(255, 255, 255, 0.2);
                --glass-border: rgba(255, 255, 255, 0.3);
            }
        }
    </style>
</head>

<body>
    <!-- Animated Background -->
    <div class="emotional-background"></div>
    
    <!-- Emotion Particles Container -->
    <div id="emotionParticles" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: var(--z-background);"></div>
    
    <!-- Main Application Container -->
    <div class="app-container">
        <div class="main-container">
            <!-- Application Header -->
            <header class="app-header">
                <div class="brand-section">
                    <h1 class="brand-logo">Synesthetic</h1>
                    <p class="brand-tagline">Digital Consciousness Through Musical Emotion</p>
                </div>
                
                <div class="auth-section">
                    <button class="auth-btn" id="authBtn">Sign In</button>
                </div>
            </header>

            <!-- Status Bar -->
            <div class="status-bar">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="statusText">Initializing...</span>
            </div>

            <!-- Main Controls Section -->
            <section class="controls-section">
                <div class="controls-grid">
                    <div class="control-card" id="liveAnalysisCard" tabindex="0" role="button" aria-label="Start live music analysis">
                        <div class="control-icon">🎤</div>
                        <div class="control-title">Live Analysis</div>
                        <div class="control-subtitle">Feel music as it plays</div>
                    </div>
                    
                    <div class="control-card" id="uploadMusicCard" tabindex="0" role="button" aria-label="Upload music file">
                        <div class="control-icon">📁</div>
                        <div class="control-title">Upload Music</div>
                        <div class="control-subtitle">Analyze your files</div>
                    </div>
                    
                    <div class="control-card" id="spotifyCard" tabindex="0" role="button" aria-label="Connect to Spotify">
                        <div class="control-icon">🎵</div>
                        <div class="control-title">Spotify</div>
                        <div class="control-subtitle">Connect your library</div>
                    </div>
                </div>
            </section>

            <!-- Upload Section (Hidden by default) -->
            <section class="upload-section hidden" id="uploadSection">
                <div class="upload-area" id="uploadArea" tabindex="0" role="button" aria-label="Upload area">
                    <div class="upload-icon">🎵</div>
                    <div class="upload-text">Drop your music file here or click to browse</div>
                    <div class="upload-subtext">Supported formats: MP3, WAV, M4A</div>
                    <input type="file" id="fileInput" accept="audio/*" aria-label="Music file input">
                </div>
            </section>

            <!-- Real-time Analysis Display -->
            <section class="analysis-section">
                <h2>🎵 Live Emotional Analysis</h2>
                <div class="analysis-grid">
                    <div class="analysis-display" id="analysisDisplay">
                        <div class="analysis-placeholder">
                            <div class="icon">🎵</div>
                            <p>Start music analysis to see your emotional synesthetic patterns</p>
                        </div>
                    </div>
                    <div class="emotional-readout">
                        <div class="readout-item">
                            <span class="readout-label">Current Emotion</span>
                            <span class="readout-value" id="currentEmotion">Neutral</span>
                        </div>
                        <div class="readout-item">
                            <span class="readout-label">Intensity</span>
                            <span class="readout-value" id="emotionalIntensity">0%</span>
                        </div>
                        <div class="readout-item">
                            <span class="readout-label">Depth</span>
                            <span class="readout-value" id="emotionalDepth">Surface</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Admin Toggle Button (Hidden by default) -->
    <button class="admin-toggle" id="adminToggle" aria-label="Open admin interface">
        🧠 Neural Interface
    </button>

    <!-- Revolutionary Admin Interface Overlay -->
    <div class="revolutionary-overlay" id="revolutionaryOverlay" role="dialog" aria-modal="true" aria-labelledby="admin-title">
        <div id="adminInterfaceContent">
            <!-- Admin interface content will be loaded here -->
        </div>
    </div>

    <!-- Core Script Imports -->
    <script src="🎨-user-interface/auth.js"></script>
    <script src="🎨-user-interface/onboarding-system.js"></script>
    <script type="module" src="🎯-core-engine/main.js"></script>
    <script type="module" src="components/audio-analyzer.js"></script>
    <script type="module" src="components/color-visualizer.js"></script>

    <!-- Soul System Scripts -->
    <script src="🧠-soul-system/factory-soul-train.js"></script>
    <script src="🧠-soul-system/emotional-memory-system.js"></script>
    <script src="🧠-soul-system/context-awareness-system.js"></script>
    <script src="🧠-soul-system/advanced-emotional-intelligence.js"></script>
    <script src="🧠-soul-system/collective-soul-network.js"></script>
    <script src="🧠-soul-system/self-aware-consciousness.js"></script>
    <script src="🧠-soul-system/emotion-feedback-system.js"></script>
    <script src="🧠-soul-system/neural-factory-soul-trainer.js"></script>
    <script src="🧠-soul-system/personality-theme-engine.js"></script>
    <script src="🧠-soul-system/soul-commentary-system.js"></script>
    <script src="🧠-soul-system/soul-personality-visualizer.js"></script>
    <script src="🧠-soul-system/digital-soul-activator.js"></script>
    <script src="🧠-soul-system/soul-status-dashboard.js"></script>
    
    <!-- Revolutionary Interface Systems -->
    <script src="🎨-revolutionary-interface/advanced-admin-portal.js"></script>
    <script src="🎨-revolutionary-interface/world-class-ui-system.js"></script>
    <script src="🎨-revolutionary-interface/advanced-synesthetic-engine.js"></script>
    
    <!-- Advanced AI Systems -->
    <script src="🤖-ai-systems/advanced-recommendation-engine.js"></script>
    <script src="🎭-emotional-therapy/emotional-therapy-system.js"></script>
    <script src="🎵-intelligent-playlists/intelligent-playlist-system.js"></script>
    
    <!-- UX Optimization -->
    <script src="🚀-ux-optimization/comprehensive-ux-system.js"></script>
    
    <!-- Social Consciousness -->
    <script type="module" src="components/social-consciousness.js"></script>
    
    <!-- Main Application Logic -->
    <script>
        // Global application state
        window.synestheticApp = {
            initialized: false,
            user: null,
            isAdmin: false,
            systems: {}
        };

        // Initialize application when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Synesthetic App Starting...');
            initializeApplication();
        });

        // Main initialization function
        async function initializeApplication() {
            try {
                updateStatus('Loading...', false);
                
                // Initialize core systems
                await initializeCoreSystems();
                
                // Setup event listeners
                setupEventListeners();
                
                // Initialize authentication
                initializeAuthentication();
                
                // Load revolutionary systems
                await loadRevolutionarySystems();
                
                // Final setup
                finalizeInitialization();
                
                console.log('✅ Synesthetic App Initialized Successfully');
                updateStatus('Ready to Feel Music', true);
                
            } catch (error) {
                console.error('❌ Application initialization failed:', error);
                updateStatus('Initialization failed', false);
            }
        }

        // Initialize core systems
        async function initializeCoreSystems() {
            // Initialize emotion engine
            try {
                const emotionModule = await import('./src/emotion-engine.js');
                window.synestheticApp.systems.emotionEngine = new emotionModule.default();
                console.log('🧠 Emotion engine initialized');
            } catch (error) {
                console.warn('🧠 Emotion engine not available:', error);
            }
            
            // Initialize audio system
            if (typeof initializeAudioSystem === 'function') {
                initializeAudioSystem();
                console.log('🎵 Audio system initialized');
            }
            
            // Mark systems as initialized
            window.synestheticApp.initialized = true;
        }

        // Setup event listeners for UI interactions
        function setupEventListeners() {
            // Live Analysis Card
            const liveAnalysisCard = document.getElementById('liveAnalysisCard');
            if (liveAnalysisCard) {
                liveAnalysisCard.addEventListener('click', handleLiveAnalysis);
                liveAnalysisCard.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        handleLiveAnalysis();
                    }
                });
            }
            
            // Upload Music Card
            const uploadMusicCard = document.getElementById('uploadMusicCard');
            if (uploadMusicCard) {
                uploadMusicCard.addEventListener('click', handleUploadMusic);
                uploadMusicCard.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        handleUploadMusic();
                    }
                });
            }
            
            // Spotify Card
            const spotifyCard = document.getElementById('spotifyCard');
            if (spotifyCard) {
                spotifyCard.addEventListener('click', handleSpotifyConnect);
                spotifyCard.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        handleSpotifyConnect();
                    }
                });
            }
            
            // Upload Area
            setupUploadArea();
            
            // Admin Toggle
            const adminToggle = document.getElementById('adminToggle');
            if (adminToggle) {
                adminToggle.addEventListener('click', toggleAdminInterface);
            }
            
            // Escape key to close admin interface
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeAdminInterface();
                }
            });
        }

        // Initialize authentication system
        function initializeAuthentication() {
            const authBtn = document.getElementById('authBtn');
            if (authBtn) {
                authBtn.addEventListener('click', handleAuthentication);
            }
            
            // Check for existing authentication
            checkExistingAuth();
        }

        // Handle authentication button click
        function handleAuthentication() {
            if (window.synestheticApp.user) {
                // User is logged in - show profile menu or logout
                handleUserMenu();
            } else {
                // User needs to sign in
                showAuthModal();
            }
        }

        // Check for existing authentication
        function checkExistingAuth() {
            // This would check with your auth system
            // For now, we'll simulate with localStorage
            const savedUser = localStorage.getItem('synesthetic_user');
            if (savedUser) {
                try {
                    const user = JSON.parse(savedUser);
                    updateAuthUI(user);
                } catch (error) {
                    console.warn('Invalid saved user data');
                }
            }
        }

        // Update authentication UI
        function updateAuthUI(user) {
            window.synestheticApp.user = user;
            const authBtn = document.getElementById('authBtn');
            
            if (authBtn) {
                authBtn.textContent = user.name || user.email.split('@')[0];
                authBtn.classList.add('authenticated');
            }
            
            // Check if user is admin
            if (user.email === 'memoire.product@gmail.com' || user.isAdmin) {
                showAdminToggle();
            }
            
            console.log('👤 User authenticated:', user.email);
        }

        // Show admin toggle button
        function showAdminToggle() {
            window.synestheticApp.isAdmin = true;
            const adminToggle = document.getElementById('adminToggle');
            if (adminToggle) {
                adminToggle.classList.add('visible');
            }
        }

        // Handle live analysis
        function handleLiveAnalysis() {
            if (!window.synestheticApp.user) {
                showAuthGate('Live Analysis', 'Sign in to analyze music in real-time and discover your emotional patterns');
                return;
            }
            
            console.log('🎤 Starting live analysis...');
            updateStatus('Requesting microphone access...', false);
            
            // Use existing app functionality if available
            if (window.app && window.app.startMicAnalysis) {
                window.app.startMicAnalysis()
                    .then(() => updateStatus('Live analysis active', true))
                    .catch(err => {
                        console.error('Microphone access denied:', err);
                        updateStatus('Microphone access denied', false);
                    });
            } else {
                updateStatus('Audio system loading...', false);
            }
        }

        // Handle upload music
        function handleUploadMusic() {
            if (!window.synestheticApp.user) {
                showAuthGate('Upload Music', 'Sign in to upload and analyze your personal music collection');
                return;
            }
            
            const uploadSection = document.getElementById('uploadSection');
            if (uploadSection) {
                uploadSection.classList.remove('hidden');
                updateStatus('Ready to upload music file', true);
            }
        }

        // Handle Spotify connection
        function handleSpotifyConnect() {
            if (!window.synestheticApp.user) {
                showAuthGate('Spotify Connection', 'Sign in to connect your Spotify and explore your musical soul');
                return;
            }
            
            console.log('🎵 Spotify integration coming soon...');
            updateStatus('Spotify integration coming soon!', true);
        }

        // Setup upload area with drag and drop
        function setupUploadArea() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            
            if (!uploadArea || !fileInput) return;
            
            uploadArea.addEventListener('click', () => fileInput.click());
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('drag-over');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('drag-over');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileUpload(files[0]);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });
        }

        // Handle file upload
        function handleFileUpload(file) {
            console.log('📁 File uploaded:', file.name);
            updateStatus(`Analyzing ${file.name}...`, false);
            
            // Here you would process the file
            // For now, simulate processing
            setTimeout(() => {
                updateStatus('File analysis complete', true);
            }, 2000);
        }

        // Show authentication gate
        function showAuthGate(feature, description) {
            alert(`${feature}\n\n${description}\n\nPlease sign in to continue.`);
        }

        // Show authentication modal
        function showAuthModal() {
            // This would show your authentication modal
            // For demo, we'll simulate login
            const email = prompt('Enter email (use memoire.product@gmail.com for admin):');
            if (email) {
                const user = {
                    email: email,
                    name: email.split('@')[0],
                    isAdmin: email === 'memoire.product@gmail.com'
                };
                
                localStorage.setItem('synesthetic_user', JSON.stringify(user));
                updateAuthUI(user);
            }
        }

        // Handle user menu
        function handleUserMenu() {
            const user = window.synestheticApp.user;
            const action = confirm(`Signed in as ${user.email}\n\nClick OK to sign out, Cancel to continue.`);
            
            if (action) {
                // Sign out
                localStorage.removeItem('synesthetic_user');
                window.synestheticApp.user = null;
                window.synestheticApp.isAdmin = false;
                
                const authBtn = document.getElementById('authBtn');
                if (authBtn) {
                    authBtn.textContent = 'Sign In';
                    authBtn.classList.remove('authenticated');
                }
                
                const adminToggle = document.getElementById('adminToggle');
                if (adminToggle) {
                    adminToggle.classList.remove('visible');
                }
                
                console.log('👋 User signed out');
            }
        }

        // Toggle admin interface
        function toggleAdminInterface() {
            if (!window.synestheticApp.isAdmin) return;
            
            const overlay = document.getElementById('revolutionaryOverlay');
            if (overlay) {
                overlay.classList.toggle('active');
                console.log('🧠 Admin interface toggled');
            }
        }

        // Close admin interface
        function closeAdminInterface() {
            const overlay = document.getElementById('revolutionaryOverlay');
            if (overlay) {
                overlay.classList.remove('active');
            }
        }

        // Load revolutionary systems
        async function loadRevolutionarySystems() {
            try {
                // Initialize systems if they exist
                const systems = [
                    'worldClassUISystem',
                    'advancedSynestheticEngine',
                    'intelligentPlaylistSystem',
                    'comprehensiveUXSystem',
                    'revolutionaryAdminPortal'
                ];
                
                for (const systemName of systems) {
                    if (window[systemName]) {
                        console.log(`✅ ${systemName} loaded`);
                        window.synestheticApp.systems[systemName] = window[systemName];
                    }
                }
                
                console.log('🚀 Revolutionary systems loaded');
                
            } catch (error) {
                console.warn('⚠️ Some revolutionary systems unavailable:', error);
            }
        }

        // Finalize initialization
        function finalizeInitialization() {
            // Setup any final configurations
            setupAccessibility();
            setupPerformanceMonitoring();
            
            // Announce readiness
            console.log('🎉 Synesthetic App Ready!');
        }

        // Setup accessibility features
        function setupAccessibility() {
            // Add keyboard navigation support
            const focusableElements = document.querySelectorAll('button, [tabindex="0"]');
            
            focusableElements.forEach(element => {
                element.addEventListener('focus', (e) => {
                    e.target.style.outline = '2px solid var(--synesthetic-primary)';
                    e.target.style.outlineOffset = '2px';
                });
                
                element.addEventListener('blur', (e) => {
                    e.target.style.outline = '';
                    e.target.style.outlineOffset = '';
                });
            });
        }

        // Setup performance monitoring
        function setupPerformanceMonitoring() {
            // Monitor performance
            if ('performance' in window) {
                window.addEventListener('load', () => {
                    setTimeout(() => {
                        const perfData = performance.getEntriesByType('navigation')[0];
                        console.log('📊 Load time:', Math.round(perfData.loadEventEnd - perfData.fetchStart) + 'ms');
                    }, 0);
                });
            }
        }

        // Update status display
        function updateStatus(text, isReady = false) {
            const statusText = document.getElementById('statusText');
            const statusIndicator = document.getElementById('statusIndicator');
            
            if (statusText) {
                statusText.textContent = text;
                statusText.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    statusText.style.transform = 'scale(1)';
                }, 200);
            }
            
            if (statusIndicator) {
                if (isReady) {
                    statusIndicator.style.background = 'var(--synesthetic-green)';
                    statusIndicator.style.boxShadow = '0 0 15px var(--synesthetic-green)';
                } else {
                    statusIndicator.style.background = 'var(--synesthetic-orange)';
                    statusIndicator.style.boxShadow = '0 0 15px var(--synesthetic-orange)';
                }
            }
        }

        // Global utility functions for external systems
        window.synestheticUtils = {
            updateAnalysisDisplay: function(emotionalState) {
                const display = document.getElementById('analysisDisplay');
                const currentEmotion = document.getElementById('currentEmotion');
                const emotionalIntensity = document.getElementById('emotionalIntensity');
                const emotionalDepth = document.getElementById('emotionalDepth');
                
                if (!emotionalState) return;
                
                // Update display with emotional data
                if (display && emotionalState.synestheticColors) {
                    const colors = emotionalState.synestheticColors.slice(0, 5);
                    display.innerHTML = `
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-bottom: 20px;">
                            ${colors.map(color => `
                                <div style="width: 40px; height: 40px; background: ${color}; border-radius: 50%; box-shadow: 0 0 20px ${color}; animation: pulse 2s infinite;"></div>
                            `).join('')}
                        </div>
                        <div style="text-align: center; color: var(--text-primary);">
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem; text-shadow: 0 0 10px currentColor;">
                                ${emotionalState.primary || 'Processing...'}
                            </div>
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">
                                Confidence: ${Math.round((emotionalState.confidence || 0) * 100)}%
                            </div>
                        </div>
                    `;
                }
                
                // Update emotional readout
                if (currentEmotion) {
                    currentEmotion.textContent = emotionalState.primary || 'Processing...';
                }
                
                if (emotionalIntensity) {
                    const intensity = Math.round((emotionalState.intensity || 0) * 100);
                    emotionalIntensity.textContent = `${intensity}%`;
                }
                
                if (emotionalDepth) {
                    const depth = emotionalState.depth || 0;
                    let depthText = depth > 0.8 ? 'Deep' : depth > 0.5 ? 'Moderate' : 'Surface';
                    emotionalDepth.textContent = depthText;
                }
            },
            
            showNotification: function(message, type = 'info') {
                console.log(`📢 ${type.toUpperCase()}: ${message}`);
            },
            
            getAppState: function() {
                return window.synestheticApp;
            }
        };

        // Export for external access
        window.updateSynestheticDisplay = window.synestheticUtils.updateAnalysisDisplay;
    </script>
</body>
</html>
